{% extends "base.html" %}

{% block title %}Network Explorer{% endblock %}

{% block extra_head %}
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

<style>
    /* Le conteneur prend une grande partie de l'√©cran */
    #mynetwork {
        width: 100%;
        height: 85vh;
        border: 1px solid #ddd;
        background-color: #ffffff;
        border-radius: 8px;
    }
    
    /* L√©gende personnalis√©e simple */
    .legend-container {
        margin-bottom: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        font-size: 0.9em;
    }
    .badge {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 5px;
        vertical-align: middle;
    }
</style>
{% endblock %}

{% block content %}
<h1>üï∏Ô∏è Instance Network Explorer</h1>
<p>Interactive visualization. Scroll to zoom, drag nodes to reorganize.</p>

<div class="legend-container">
    <strong>Key Entities:</strong> &nbsp;
    <span class="badge" style="background:#ff6b35;"></span>Criteria &nbsp;
    <span class="badge" style="background:#20c997;"></span>Metric &nbsp;
    <span class="badge" style="background:#6f42c1;"></span>Definitions
</div>

<div id="mynetwork"></div>

<script type="text/javascript">
    // 1. R√©cup√©ration des donn√©es inject√©es par Python
    var rawData = {{ instance_network | safe }};
    
    var nodes = new vis.DataSet(rawData.nodes);
    var edges = new vis.DataSet(rawData.edges);

    var container = document.getElementById('mynetwork');
    var data = {
        nodes: nodes,
        edges: edges
    };

    // 2. Configuration de Vis.js
    var options = {
        nodes: {
            shape: 'dot',
            size: 20,
            font: {
                size: 14,
                color: '#333' // Texte sombre
            },
            borderWidth: 2,
            shadow: true
        },
        edges: {
            width: 1,
            smooth: {
                type: 'continuous' // Courbes fluides
            }
        },
        physics: {
            enabled: true,
            stabilization: false, // Permet de voir le graphe bouger au chargement
            barnesHut: {
                gravitationalConstant: -4000, // R√©pulsion forte pour √©carter les noeuds
                centralGravity: 0.3,
                springLength: 150, // Longueur des liens
                springConstant: 0.04,
                damping: 0.09
            }
        },
        // 3. D√©finition des Couleurs par Groupes (Classes de l'ontologie)
        groups: {
            Criteria: { 
                color: { background: '#ff6b35', border: '#e55a2b' }, 
                shape: 'dot' 
            },
            Metric: { 
                color: { background: '#20c997', border: '#1aa179' }, 
                shape: 'diamond' // Forme diff√©rente pour les m√©triques
            },
            Fairness: {
                color: { background: '#6f42c1', border: '#5a32a3' }
            },
            // Style par d√©faut pour tout le reste
            Default: { 
                color: { background: '#97c2fc', border: '#2b7ce9' } 
            }
        },
        interaction: {
            navigationButtons: true,
            keyboard: false,
            tooltipDelay: 200
        }
    };

    var network = new vis.Network(container, data, options);
    
    // Double-clic pour ouvrir la page de l'entit√©
    network.on("doubleClick", function (params) {
        if (params.nodes.length === 1) {
            var nodeId = params.nodes[0];
            window.location.href = "entities/" + nodeId + ".html";
        }
    });
</script>
{% endblock %}